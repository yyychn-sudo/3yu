name: Check Settings Variables

on:
  workflow_dispatch:

jobs:
  check-variables:
    runs-on: ubuntu-latest
    
    steps:
    - name: æ£€æŸ¥æ‰€æœ‰å˜é‡å’ŒSecrets
      run: |
        echo "=== æ£€æŸ¥GitHub Variableså’ŒSecrets ==="
        echo ""
        
        echo "ğŸ“‹ é€šè¿‡varsè®¿é—®çš„å˜é‡:"
        echo "----------------------"
        echo "RELAY_SERVER via vars: '${{ vars.RELAY_SERVER }}'"
        echo "RS_PUB_KEY via vars: '${{ vars.RS_PUB_KEY }}'"
        echo "CUSTOM_API_URL via vars: '${{ vars.CUSTOM_API_URL }}'"
        echo ""
        
        echo "ğŸ“‹ é€šè¿‡secretsè®¿é—®çš„å˜é‡:"
        echo "----------------------"
        echo "RELAY_SERVER via secrets: '${{ secrets.RELAY_SERVER }}'"
        echo "RS_PUB_KEY via secrets: '${{ secrets.RS_PUB_KEY }}'"
        echo "CUSTOM_API_URL via secrets: '${{ secrets.CUSTOM_API_URL }}'"
        echo ""
        
        echo "ğŸ“‹ ç¯å¢ƒå˜é‡æ£€æŸ¥:"
        echo "----------------------"
        echo "RELAY_SERVER env: '$RELAY_SERVER'"
        echo "RS_PUB_KEY env: '$RS_PUB_KEY'"
        echo "CUSTOM_API_URL env: '$CUSTOM_API_URL'"
        echo ""
        
        echo "ğŸ” å˜é‡é•¿åº¦å’Œæ ¼å¼æ£€æŸ¥:"
        echo "----------------------"
        
        check_var() {
          local name=$1
          local value=$2
          echo -n "$name: "
          if [ -n "$value" ]; then
            echo "âœ… å·²è®¾ç½® (${#value} å­—ç¬¦)"
            echo "   åŸå§‹å€¼: '$value'"
            echo "   å»é™¤ç©ºç™½å: '$(echo "$value" | tr -d '[:space:]')'"
            
            # æ£€æŸ¥æ˜¯å¦æœ‰æ¢è¡Œç¬¦
            if echo "$value" | grep -q $'\n'; then
              echo "   âš ï¸  åŒ…å«æ¢è¡Œç¬¦"
            fi
            
            # æ£€æŸ¥æ˜¯å¦æœ‰ç‰¹æ®Šå­—ç¬¦
            if echo "$value" | grep -q '[^a-zA-Z0-9._=/:@-]'; then
              echo "   âš ï¸  åŒ…å«ç‰¹æ®Šå­—ç¬¦"
            fi
            
          else
            echo "âŒ æœªè®¾ç½®"
          fi
        }
        
        check_var "RELAY_SERVER" "${{ vars.RELAY_SERVER }}"
        echo ""
        check_var "RS_PUB_KEY" "${{ vars.RS_PUB_KEY }}"
        echo ""
        check_var "CUSTOM_API_URL" "${{ vars.CUSTOM_API_URL }}"
        echo ""
        
        echo "ğŸ’¡ å»ºè®®:"
        echo "1. ç¡®ä¿å˜é‡åœ¨ Settings â†’ Secrets and variables â†’ Actions â†’ Variables ä¸­è®¾ç½®"
        echo "2. å¦‚æœä½¿ç”¨ Secretsï¼Œè¯·æ”¹ä¸º secrets.RELAY_SERVER"
        echo "3. æ£€æŸ¥å˜é‡å€¼æ˜¯å¦æœ‰å¤šä½™ç©ºæ ¼æˆ–æ¢è¡Œ"
